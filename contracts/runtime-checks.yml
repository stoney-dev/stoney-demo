version: 1
feature: demo
description: Runtime + DB invariants

contracts:
  - name: runtime_checks
    description: CI runtime sanity checks.
    checks:
      - id: node_present
        work_item: "KAN-124"
        says: "CI runner must have Node installed"
        do:
          - exec:
              run: "node -v"
            then:
              exit_code: 0
              stdout_contains: "v"

  - name: db_invariants
    description: Database must be reachable in CI.
    checks:
      - id: db_smoke
        work_item: "KAN-125"
        says: "Database must be reachable and able to execute a simple query"
        do:
          - sql:
              driver: postgres
              url_env: STONEY_DB_URL
              query: "SELECT 1 AS ok;"
            then:
              rows: 1
              equals:
                ok: 1